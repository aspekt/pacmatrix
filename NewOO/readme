A new version in C++

Unfinished.
